{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nconst useRecorder = () => {\n  _s();\n  const [audio, setAudio] = useState(\"\");\n  const [isRecording, setIsRecording] = useState(false);\n  const [recorder, setRecorder] = useState(null);\n  async function requestRecorder() {\n    // alert(\"request recorder\");\n\n    const stream = await navigator.mediaDevices.getUserMedia({\n      audio: true\n    });\n    return new MediaRecorder(stream);\n  }\n  function onAudio(data) {\n    const f = data;\n    const reader = new FileReader();\n    reader.onload = () => {\n      setAudio([reader.result, URL.createObjectURL(f)]);\n    };\n    if (f) {\n      reader.readAsDataURL(f);\n    }\n  }\n  useEffect(() => {\n    // Lazily obtain recorder first time we're recording.\n    if (recorder === null) {\n      if (isRecording) {\n        requestRecorder().then(r => {\n          setRecorder(r);\n        });\n      }\n      return;\n    }\n\n    // Manage recorder state.\n    if (isRecording) {\n      recorder.start();\n      console.log(recorder);\n    } else {\n      //   console.log(recorder);\n      recorder.stop();\n      console.log(recorder);\n    }\n\n    // Obtain the audio when ready.\n\n    recorder.ondataavailable = e => {\n      //   setAudio([URL.createObjectURL(e.data)]);\n      onAudio(e.data);\n      console.log(audio);\n    };\n    recorder.onstop = e => {\n      //   setAudioURL(URL.createObjectURL(e.data));\n      // console.log(audioURL);\n      //   const blob = new Blob(e.data, { type: \"audio/ogg; codecs=opus\" });\n      //   const audioURL1 = window.URL.createObjectURL(blob);\n      //   setAudioURL(audioURL1);\n    };\n  }, [recorder, isRecording]);\n  const startRecording = () => {\n    setIsRecording(true);\n    console.log(\"start recording\");\n  };\n  const stopRecording = () => {\n    setIsRecording(false);\n    console.log(\"stop recording\");\n  };\n  return [audio, setAudio, isRecording, startRecording, stopRecording];\n};\n_s(useRecorder, \"r2TUJ7iClty6S63RH676EuDP4Qk=\");\nexport default useRecorder;","map":{"version":3,"names":["useEffect","useState","useRecorder","audio","setAudio","isRecording","setIsRecording","recorder","setRecorder","requestRecorder","stream","navigator","mediaDevices","getUserMedia","MediaRecorder","onAudio","data","f","reader","FileReader","onload","result","URL","createObjectURL","readAsDataURL","then","r","start","console","log","stop","ondataavailable","e","onstop","startRecording","stopRecording"],"sources":["/home/dmitrii/Dev/vk/front/2022-2-VK-EDU-FS-Frontend-D-Oreshkin/react-chat/src/components/ChatMessageForm/Recorder.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\n\nconst useRecorder = () => {\n  const [audio, setAudio] = useState(\"\");\n  const [isRecording, setIsRecording] = useState(false);\n  const [recorder, setRecorder] = useState(null);\n\n  async function requestRecorder() {\n    // alert(\"request recorder\");\n\n    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n    return new MediaRecorder(stream);\n  }\n\n  function onAudio(data) {\n    const f = data;\n    const reader = new FileReader();\n    reader.onload = () => {\n      setAudio([reader.result, URL.createObjectURL(f)]);\n    };\n\n    if (f) {\n      reader.readAsDataURL(f);\n    }\n  }\n\n  useEffect(() => {\n    // Lazily obtain recorder first time we're recording.\n    if (recorder === null) {\n      if (isRecording) {\n        requestRecorder().then((r) => {\n          setRecorder(r);\n        });\n      }\n      return;\n    }\n\n    // Manage recorder state.\n    if (isRecording) {\n      recorder.start();\n      console.log(recorder);\n    } else {\n      //   console.log(recorder);\n      recorder.stop();\n      console.log(recorder);\n    }\n\n    // Obtain the audio when ready.\n\n    recorder.ondataavailable = (e) => {\n      //   setAudio([URL.createObjectURL(e.data)]);\n      onAudio(e.data);\n      console.log(audio);\n    };\n\n    recorder.onstop = (e) => {\n      //   setAudioURL(URL.createObjectURL(e.data));\n      // console.log(audioURL);\n      //   const blob = new Blob(e.data, { type: \"audio/ogg; codecs=opus\" });\n      //   const audioURL1 = window.URL.createObjectURL(blob);\n      //   setAudioURL(audioURL1);\n    };\n  }, [recorder, isRecording]);\n\n  const startRecording = () => {\n    setIsRecording(true);\n    console.log(\"start recording\");\n  };\n\n  const stopRecording = () => {\n    setIsRecording(false);\n    console.log(\"stop recording\");\n  };\n\n  return [audio, setAudio, isRecording, startRecording, stopRecording];\n};\n\nexport default useRecorder;\n"],"mappings":";AAAA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAE3C,MAAMC,WAAW,GAAG,MAAM;EAAA;EACxB,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAGH,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACI,WAAW,EAAEC,cAAc,CAAC,GAAGL,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACM,QAAQ,EAAEC,WAAW,CAAC,GAAGP,QAAQ,CAAC,IAAI,CAAC;EAE9C,eAAeQ,eAAe,GAAG;IAC/B;;IAEA,MAAMC,MAAM,GAAG,MAAMC,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC;MAAEV,KAAK,EAAE;IAAK,CAAC,CAAC;IACzE,OAAO,IAAIW,aAAa,CAACJ,MAAM,CAAC;EAClC;EAEA,SAASK,OAAO,CAACC,IAAI,EAAE;IACrB,MAAMC,CAAC,GAAGD,IAAI;IACd,MAAME,MAAM,GAAG,IAAIC,UAAU,EAAE;IAC/BD,MAAM,CAACE,MAAM,GAAG,MAAM;MACpBhB,QAAQ,CAAC,CAACc,MAAM,CAACG,MAAM,EAAEC,GAAG,CAACC,eAAe,CAACN,CAAC,CAAC,CAAC,CAAC;IACnD,CAAC;IAED,IAAIA,CAAC,EAAE;MACLC,MAAM,CAACM,aAAa,CAACP,CAAC,CAAC;IACzB;EACF;EAEAjB,SAAS,CAAC,MAAM;IACd;IACA,IAAIO,QAAQ,KAAK,IAAI,EAAE;MACrB,IAAIF,WAAW,EAAE;QACfI,eAAe,EAAE,CAACgB,IAAI,CAAEC,CAAC,IAAK;UAC5BlB,WAAW,CAACkB,CAAC,CAAC;QAChB,CAAC,CAAC;MACJ;MACA;IACF;;IAEA;IACA,IAAIrB,WAAW,EAAE;MACfE,QAAQ,CAACoB,KAAK,EAAE;MAChBC,OAAO,CAACC,GAAG,CAACtB,QAAQ,CAAC;IACvB,CAAC,MAAM;MACL;MACAA,QAAQ,CAACuB,IAAI,EAAE;MACfF,OAAO,CAACC,GAAG,CAACtB,QAAQ,CAAC;IACvB;;IAEA;;IAEAA,QAAQ,CAACwB,eAAe,GAAIC,CAAC,IAAK;MAChC;MACAjB,OAAO,CAACiB,CAAC,CAAChB,IAAI,CAAC;MACfY,OAAO,CAACC,GAAG,CAAC1B,KAAK,CAAC;IACpB,CAAC;IAEDI,QAAQ,CAAC0B,MAAM,GAAID,CAAC,IAAK;MACvB;MACA;MACA;MACA;MACA;IAAA,CACD;EACH,CAAC,EAAE,CAACzB,QAAQ,EAAEF,WAAW,CAAC,CAAC;EAE3B,MAAM6B,cAAc,GAAG,MAAM;IAC3B5B,cAAc,CAAC,IAAI,CAAC;IACpBsB,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC;EAChC,CAAC;EAED,MAAMM,aAAa,GAAG,MAAM;IAC1B7B,cAAc,CAAC,KAAK,CAAC;IACrBsB,OAAO,CAACC,GAAG,CAAC,gBAAgB,CAAC;EAC/B,CAAC;EAED,OAAO,CAAC1B,KAAK,EAAEC,QAAQ,EAAEC,WAAW,EAAE6B,cAAc,EAAEC,aAAa,CAAC;AACtE,CAAC;AAAC,GAzEIjC,WAAW;AA2EjB,eAAeA,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}