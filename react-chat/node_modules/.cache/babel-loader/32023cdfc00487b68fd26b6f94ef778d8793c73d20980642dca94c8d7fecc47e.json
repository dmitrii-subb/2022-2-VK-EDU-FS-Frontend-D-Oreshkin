{"ast":null,"code":"var _jsxFileName = \"/home/dmitrii/Dev/vk/front/2022-2-VK-EDU-FS-Frontend-D-Oreshkin/react-chat/src/components/ChatMessageForm/ChatMessageForm.jsx\",\n  _s = $RefreshSig$();\nimport React from \"react\";\nimport { useState } from \"react\";\nimport { connect, useSelector } from \"react-redux\";\nimport styles from \"./ChatMessageForm.module.scss\";\nimport useRecorder from \"./Recorder\";\nimport { newMessage } from \"../../actions/messageAction\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction ChatMessageForm(props) {\n  _s();\n  const chat = useSelector(state => state.activeChatReduser);\n  const [value, setValue] = useState(\"\");\n  const [file, setFile] = useState([]);\n  let [audio, setAudio, isRecording, startRecording, stopRecording] = useRecorder();\n  const [location, setLocation] = useState(\"\");\n  function getLocation(event) {\n    event.preventDefault();\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(showPosition);\n    } else {\n      console.log(\"Geolocation is not supported by this browser.\");\n    }\n  }\n  function showPosition(position) {\n    setLocation(`https://www.openstreetmap.org/#map=18/${position.coords.latitude}/${position.coords.longitude}`);\n  }\n  function handleChange(event) {\n    setValue(event.target.value);\n  }\n  function onFile(event) {\n    const f = event.target.files[0];\n    const reader = new FileReader();\n    reader.onload = () => {\n      setFile([reader.result, URL.createObjectURL(event.target.files[0])]);\n    };\n    if (f) {\n      reader.readAsDataURL(f);\n    }\n  }\n  function handleSubmit(event) {\n    event.preventDefault();\n    if (value === \"\" && file.length === 0 && audio.length === 0) {\n      return;\n    }\n    let message = {\n      text: value,\n      chat_id: chat.id,\n      author_id: 2,\n      // когда сделаю авторизацию, это поле можно будет убрать\n      author: \"Dmitrii Oreshkin\",\n      file: file[0],\n      audio: audio[0],\n      location: location\n    };\n    props.newMessage(message);\n    setValue(\"\");\n    setFile([]);\n    setLocation(\"\");\n    setAudio([]);\n    message.location = \"\";\n    message.audio = [];\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: styles.container,\n    children: [file.length !== 0 && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        className: styles.imagePreview,\n        src: file[1],\n        alt: \"image_preview\",\n        onClick: () => setFile([])\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 11\n      }, this)\n    }, void 0, false), /*#__PURE__*/_jsxDEV(\"form\", {\n      className: styles.form,\n      action: \"/\",\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: styles.formInput,\n        name: \"message-text\",\n        placeholder: \"C\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\",\n        type: \"textarea\",\n        value: value,\n        onChange: handleChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        id: \"file\",\n        onChange: onFile,\n        accept: \"image/*\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.addDocumentBtn,\n        children: /*#__PURE__*/_jsxDEV(\"label\", {\n          className: styles.button,\n          htmlFor: \"file\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"material-icons\",\n            children: \"attachment\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.addDocumentBtn,\n        onClick: getLocation,\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"material-icons\",\n          children: \"location_on\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: styles.addAudioBtn,\n        onMouseDown: startRecording,\n        onMouseUp: e => {\n          stopRecording();\n          handleSubmit(e);\n        },\n        children: [!isRecording && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"material-icons\",\n          children: \"mic\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 28\n        }, this), isRecording && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"material-icons\",\n          children: \"record_voice_over\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatMessageForm, \"Bn60wgXsrUaFkDQT76P4B6AmN4U=\", false, function () {\n  return [useSelector, useRecorder];\n});\n_c = ChatMessageForm;\nconst mapStateToProps = state => ({\n  messages: state.messageReduser.messages\n});\nexport default connect(mapStateToProps, {\n  newMessage\n})(ChatMessageForm);\n\n// export { ChatMessageForm };\nvar _c;\n$RefreshReg$(_c, \"ChatMessageForm\");","map":{"version":3,"names":["React","useState","connect","useSelector","styles","useRecorder","newMessage","ChatMessageForm","props","chat","state","activeChatReduser","value","setValue","file","setFile","audio","setAudio","isRecording","startRecording","stopRecording","location","setLocation","getLocation","event","preventDefault","navigator","geolocation","getCurrentPosition","showPosition","console","log","position","coords","latitude","longitude","handleChange","target","onFile","f","files","reader","FileReader","onload","result","URL","createObjectURL","readAsDataURL","handleSubmit","length","message","text","chat_id","id","author_id","author","container","imagePreview","form","formInput","addDocumentBtn","button","addAudioBtn","e","mapStateToProps","messages","messageReduser"],"sources":["/home/dmitrii/Dev/vk/front/2022-2-VK-EDU-FS-Frontend-D-Oreshkin/react-chat/src/components/ChatMessageForm/ChatMessageForm.jsx"],"sourcesContent":["import React from \"react\";\nimport { useState } from \"react\";\nimport { connect, useSelector } from \"react-redux\";\nimport styles from \"./ChatMessageForm.module.scss\";\nimport useRecorder from \"./Recorder\";\nimport { newMessage } from \"../../actions/messageAction\";\n\nfunction ChatMessageForm(props) {\n  const chat = useSelector((state) => state.activeChatReduser);\n\n  const [value, setValue] = useState(\"\");\n  const [file, setFile] = useState([]);\n  let [audio, setAudio, isRecording, startRecording, stopRecording] =\n    useRecorder();\n\n  const [location, setLocation] = useState(\"\");\n\n  function getLocation(event) {\n    event.preventDefault();\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(showPosition);\n    } else {\n      console.log(\"Geolocation is not supported by this browser.\");\n    }\n  }\n\n  function showPosition(position) {\n    setLocation(\n      `https://www.openstreetmap.org/#map=18/${position.coords.latitude}/${position.coords.longitude}`\n    );\n  }\n\n  function handleChange(event) {\n    setValue(event.target.value);\n  }\n\n  function onFile(event) {\n    const f = event.target.files[0];\n    const reader = new FileReader();\n    reader.onload = () => {\n      setFile([reader.result, URL.createObjectURL(event.target.files[0])]);\n    };\n\n    if (f) {\n      reader.readAsDataURL(f);\n    }\n  }\n\n  function handleSubmit(event) {\n    event.preventDefault();\n\n    if (value === \"\" && file.length === 0 && audio.length === 0) {\n      return;\n    }\n\n    let message = {\n      text: value,\n      chat_id: chat.id,\n      author_id: 2, // когда сделаю авторизацию, это поле можно будет убрать\n      author: \"Dmitrii Oreshkin\",\n      file: file[0],\n      audio: audio[0],\n      location: location,\n    };\n\n    props.newMessage(message);\n    setValue(\"\");\n    setFile([]);\n    setLocation(\"\");\n    setAudio([]);\n\n    message.location = \"\";\n    message.audio = [];\n  }\n\n  return (\n    <div className={styles.container}>\n      {file.length !== 0 && (\n        <>\n          <img\n            className={styles.imagePreview}\n            src={file[1]}\n            alt=\"image_preview\"\n            onClick={() => setFile([])}\n          />\n        </>\n      )}\n\n      <form className={styles.form} action=\"/\" onSubmit={handleSubmit}>\n        <input\n          className={styles.formInput}\n          name=\"message-text\"\n          placeholder=\"Cообщение\"\n          type=\"textarea\"\n          value={value}\n          onChange={handleChange}\n        />\n\n        <input type=\"file\" id=\"file\" onChange={onFile} accept=\"image/*\" />\n        <div className={styles.addDocumentBtn}>\n          <label className={styles.button} htmlFor=\"file\">\n            <span className=\"material-icons\">attachment</span>\n          </label>\n        </div>\n        <div className={styles.addDocumentBtn} onClick={getLocation}>\n          <span className=\"material-icons\">location_on</span>\n        </div>\n        <button\n          className={styles.addAudioBtn}\n          onMouseDown={startRecording}\n          onMouseUp={(e) => {\n            stopRecording();\n            handleSubmit(e);\n          }}\n        >\n          {!isRecording && <span className=\"material-icons\">mic</span>}\n          {isRecording && (\n            <span className=\"material-icons\">record_voice_over</span>\n          )}\n        </button>\n      </form>\n    </div>\n  );\n}\n\nconst mapStateToProps = (state) => ({\n  messages: state.messageReduser.messages,\n});\n\nexport default connect(mapStateToProps, { newMessage })(ChatMessageForm);\n\n// export { ChatMessageForm };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}